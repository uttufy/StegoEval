# CSV Output Structure

This document describes the CSV files generated by StegoEval and the relationships between them.

## File Overview

| File | Description | Primary Key |
|------|-------------|-------------|
| `results-{run_name}.csv` | Full benchmark results | `image` |
| `results-{run_name}-clean.csv` | No-attack baseline results | `image` |
| `results-{run_name}-compression.csv` | Compression attack results | `image` |
| `results-{run_name}-filtering.csv` | Blur/filter attack results | `image` |
| `results-{run_name}-noise.csv` | Noise attack results | `image` |
| `results-{run_name}-geometric.csv` | Geometric attack results | `image` |
| `results-{run_name}-capacity.csv` | Capacity max text length results | `image` |
| `results-{run_name}-combo.csv` | Combination attack results | `image` |
| `scores-{run_name}.csv` | Algorithm scores summary | `algorithm` |
| `scores-{run_name}-by-category.csv` | Detailed scores by category | `algorithm`, `attack_category` |

## Primary Key

The **`image`** column serves as the primary key across all result CSV files. This allows joining and correlating results across different attack types.

Example: Join clean results with compression results:
```python
import pandas as pd

clean = pd.read_csv('results-benchmark-clean.csv')
compression = pd.read_csv('results-benchmark-compression.csv')

# Merge on image filename
merged = pd.merge(clean, compression, on='image', suffixes=('_clean', '_comp'))
```

## Results CSV Structure

### Common Columns (All Result Files)

| Column | Type | Description |
|--------|------|-------------|
| `image` | string | Image filename (primary key) |
| `algorithm` | string | Steganography algorithm name |
| `payload_size` | int | Size of embedded payload in characters |
| `attack_category` | string | Attack type: `none`, `compression`, `noise`, `filtering`, `geometric`, `capacity`, `combo` |
| `attack_name` | string | Specific attack name (e.g., `jpeg`, `gaussian_blur`, `max_text_length`) |
| `attack_params` | string | Attack parameters as string (e.g., `quality=90`) |

### Distortion Metrics Columns

| Column | Type | Description |
|--------|------|-------------|
| `mse` | float | Mean Squared Error (cover vs stego) |
| `rmse` | float | Root Mean Squared Error |
| `psnr` | float | Peak Signal-to-Noise Ratio (dB) |
| `ssim` | float | Structural Similarity Index (0-1) |
| `aad` | float | Average Absolute Difference |
| `nad` | float | Normalized Absolute Difference |
| `ncc_image` | float | Normalized Cross-Correlation (cover vs stego) |

### Robustness Metrics Columns

| Column | Type | Description |
|--------|------|-------------|
| `ber` | float | Bit Error Rate (0 = perfect, 1 = completely corrupted) |
| `ncc_secret` | float | NCC between embedded and extracted payload |
| `payload_recovered` | bool | Whether payload was successfully recovered (BER = 0) |
| `embedded_payload` | string | The original embedded payload |
| `extracted_payload` | string | The extracted payload after attack |

## Scores CSV Structure

### `scores-{run_name}.csv`

| Column | Type | Description |
|--------|------|-------------|
| `algorithm` | string | Algorithm name (primary key) |
| `compression_score` | float | Composite score for compression attacks (0-100) |
| `blur_score` | float | Composite score for blur/filtering attacks (0-100) |
| `noise_score` | float | Composite score for noise attacks (0-100) |
| `geometric_score` | float | Composite score for geometric attacks (0-100) |
| `capacity_score` | float | Composite score based on maximum text length capacity (0-100) |
| `combo_score` | float | Composite score for combination attacks (0-100) |
| `overall_score` | float | Overall weighted score across all attacks (0-100) |
| `total_images` | int | Total number of test images |
| `total_payloads_recovered` | int | Number of payloads successfully recovered |
| `overall_recovery_rate` | float | Percentage of successful recoveries (0-1) |

### `scores-{run_name}-by-category.csv`

| Column | Type | Description |
|--------|------|-------------|
| `algorithm` | string | Algorithm name |
| `attack_category` | string | Attack category |
| `avg_ssim` | float | Average SSIM for this category |
| `avg_psnr` | float | Average PSNR for this category |
| `avg_ber` | float | Average BER for this category |
| `recovery_rate` | float | Payload recovery rate |
| `distortion_score` | float | Distortion component score |
| `robustness_score` | float | Robustness component score |
| `overall_score` | float | Combined score for this category |
| `images_tested` | int | Number of images tested |

## Score Formula

The StegnoEval score is calculated as:

```
Overall Score = (Distortion Score × 0.4) + (Robustness Score × 0.6)
```

Where:
- **Distortion Score** = (SSIM × 70%) + (normalized PSNR × 30%)
- **Robustness Score** = (1 - BER) × 100 (if recovered) or 0 (if not recovered)

Higher scores indicate better performance (0-100 scale).

## Relationship Diagram

```
results-{run_name}.csv (primary)
    │
    ├── results-{run_name}-clean.csv (subset: attack_category = 'none')
    │
    ├── results-{run_name}-compression.csv (subset: attack_category = 'compression')
    │
    ├── results-{run_name}-filtering.csv (subset: attack_category = 'filtering')
    │
    ├── results-{run_name}-noise.csv (subset: attack_category = 'noise')
    │
    ├── results-{run_name}-geometric.csv (subset: attack_category = 'geometric')
    │
    ├── results-{run_name}-capacity.csv (subset: attack_category = 'capacity')
    │
    ├── results-{run_name}-combo.csv (subset: attack_category = 'combo')
    │
    └── scores-{run_name}.csv (aggregated from main results)
            │
            └── scores-{run_name}-by-category.csv (detailed breakdown)
```

## Example Usage

### Compare algorithm performance across attacks

```python
import pandas as pd

# Load all results
results = pd.read_csv('results-benchmark.csv')
scores = pd.read_csv('scores-benchmark.csv')

# Get best algorithm
best = scores.loc[scores['overall_score'].idxmax()]
print(f"Best algorithm: {best['algorithm']} (score: {best['overall_score']:.1f})")

# Compare compression resistance
print(scores[['algorithm', 'compression_score']].sort_values('compression_score', ascending=False))
```

### Track per-image performance

```python
# Get all results for a specific image
img_results = results[results['image'] == 'picsum_001.jpg']
print(img_results[['attack_category', 'attack_name', 'ber', 'payload_recovered']])
```
